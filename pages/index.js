import { get } from '@/lib/helpers'
import Head from 'next/head'
import Link from 'next/link'
import Image from 'next/image'

/**
 * server side
 * @param {*} context 
 * @returns 
 */
export async function getServerSideProps(context) {
  // define
  const cities = await get("/city")
  const needs = await get("/need")
  const rvps = await get("/")

  //
  return {
    props: { cities, needs, rvps },
  }
}

/**
 * client side
 * @param {*} properties 
 * @returns 
 */
export default function Home({ cities, needs, rvps }) {

  //
  return (
    <>
      <Head>
        <title>Help</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main>
        {/* request form */}
        <div className='container'>

          <form className='was-validated row gy-2 gx-3'>

            <div className='col-auto'>
              <select className='form-select' placeholder='city name' required>
                {
                  cities.map((city) => {
                    return <option key={city._id}>{city.cityName}</option>
                  })
                }
              </select>
            </div>

            <div className='col-auto'>
              <select className='form-select' placeholder='type of need' required>
                {
                  needs.map((need) => {
                    return <option key={need._id}>{need.kind}</option>
                  })
                }
              </select>
            </div>

            <div className='col-auto'>
              <button className='btn btn-success' type='submit'>Help Request</button>
            </div>

          </form>
        </div>

        {/* table */}
        <div className='container'>
          <table className='table'>
            <thead>
              <tr>
                <th scope='col'>city</th>
                <th scope='col'>volunteer</th>
                <th scope='col'>need</th>
                <th scope='col'>calendar</th>
                <th scope='col'>geolocation</th>
              </tr>
            </thead>
            <tbody>
              {
                rvps.map((rvp) => {
                  return <tr key={rvp._id}>
                    <td>{rvp.cityName}</td>
                    <td>
                      <span className='badge bg-secondary' title='total participants'></span>
                      <Link href="#" data-bs-toggle='modal' data-bs-target='#modal' title='be volunteer'>
                        <div>
                          <Image src='/logo.png' width='32' height='32' alt='volunteer'></Image>
                        </div>
                      </Link>
                    </td>
                    <td>{rvp.typeOfNeed}</td>
                    <td>{rvp.calendar}</td>
                    <td>{rvp.geolocation.latitude}</td>
                  </tr>
                })
              }
            </tbody>
          </table>
        </div>
      </main>
    </>
  )
}
